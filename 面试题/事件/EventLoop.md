# Event Loop

## 相关数据结构
- 栈（stack）：遵循后进先出（LIFO）原则的有序集合，新添加的元素保存在栈顶。栈在编程语言的编译器和内存中存储基本数据类型和对象的指针、方法调用等
- 队列（queue）：遵循先进先出（FIFO）原则的有序集合，队列在尾部添加新元素，并在顶部移除元素 。最常见的例子是打印队列
- 堆（heap）：是基于树抽象数据类型的一种特殊的数据结构，无序存储，可以根据引用直接获取

## 堆内存和栈内存
- js中引用类型值的大小是不固定的，会被存储到堆内存中，由系统自动分配存储空间。js中不允许直接访问堆内存中的位置，而是操作对象的**引用**
- js中的基础类型都有固定大小，会被存储到栈内存中，可以直接操作栈内存空间的值

## 执行栈
- 调用一个方法时，js会生成一个与这个方法对应的执行环境，又叫执行上下文（context）
- 这个执行环境中保存着该方法的私有作用域、上层作用域（作用域链）、方法的参数，以及这个作用域中定义的变量和this的指向
- js是单线程的，方法会按顺序被排列在一个单独的地方，这个地方就是执行栈

## 任务队列
- 事件队列是一个存储着**异步任务**的队列，其中的任务严格按照时间先后顺序执行，排在队头的任务将会率先执行。
- 事件队列每次仅执行一个任务；执行栈则是一个类似于函数调用栈的运行容器，当执行栈为空时JS引擎便检查事件队列，如果事件队列不为空的话，事件队列便将第一个任务压入执行栈中运行

## 事件循环
- js中处理同步和异步任务的机制就是事件循环
- 流程大致如下：
  - 所有同步任务都在主线程上执行，形成一个执行栈（Execution Context Stack）
  - 而异步任务会被放置到Task Table（异步处理模块），当异步任务有了运行结果，就将该函数移入到**任务队列**
  - 一旦执行栈中的所有同步任务执行完毕，引擎就会读取任务队列，然后将任务队列中的第一个任务压入执行栈中运行
- 主线程不断重复第三步，也就是只要主线程空了，就会去读取任务队列，该过程不断重复，就是所谓的事件循环

## 宏任务和微任务