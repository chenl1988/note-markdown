## nginx

- Nginx 是一款轻量级的 HTTP 服务器，采用事件驱动的异步非阻塞处理方式框架，这让其具有极好的 IO 性能，**时常用于服务端的反向代理和负载均衡**。

* Nginx 的优点
  - 支持海量并发：采用 IO 多路复用 epoll。官方测试 Nginx 能够支持 5 万并发链接，实际生产环境中可以支撑 2-4 万并发连接数
  - 内存消耗少：在主流的服务器中 Nginx 目前是内存消耗最小的了，
  - 免费使用可以商业化：Nginx 为开源软件，采用的是 2-clause BSD-link 协议，可以免费使用，并且可以用于商业
  - 配置文件简单：网络和程序配置通俗易懂。
  - 跨平台服务器，可以运行在 Linux、Windows、FreeBSD、Solaris、AIX、Mac OS 等操作系统上

---

### 代理(正向代理,反向代理)

- 所谓代理就是一个代表，一个渠道；涉及到两个角色，一个是被代理角色，一个是目标角色，被代理角色通过这个代理访问目标角色完成一些任务的过程为代理操作过程；

- 正向代理：“它代理的是客户端，代客户端发出请求”，是一个位于客户端和原始服务器（origin server）之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标（原始服务器），然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端必须要进行一些特别的设置才能使用正向代理；正向代理的用途：

  - 访问原来无法访问的资源，如 Google
  - 可以做缓存，加速访问资源
  - 对客户端访问授权，上网进行认证
  - 代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息

- 反向代理：“它代理的是服务端，代服务端接收请求”，主要用于服务器集群分布式部署的情况下，反向代理隐藏了服务器的信息；反向代理的作用：

  - 保证内网的安全，通常将反向代理作为公网访问地址，Web 服务器是内网
  - 负载均衡，通过反向代理服务器来优化网站的负载

- 正向代理和反向代理的区别：
  - 正向代理中，Proxy 和 Client 同属于一个 LAN（"正向代理和反向代理二者之间的区别.png"图中方框内），隐藏了客户端信息
  - 反向代理中，Proxy 和 Server 同属于一个 LAN（"正向代理和反向代理二者之间的区别.png"图中方框内），隐藏了服务端信息
  - 实际上，Proxy 在两种代理中做的事情都是替服务器代为收发请求和响应，不过从结构上看正好左右互换了一下，所以把后出现的那种代理方式称为反向代理了

---

### 负载均衡

- 客户端发送的、Nginx 反向代理服务器接收到的请求数量，就是我们说的负载量
- 请求数量按照一定的规则进行分发到不同的服务器处理的规则，就是一种均衡规则
- 所以将服务器接收到的请求按照规则分发的过程，称为负载均衡
- 负载均衡在实际项目操作过程中，有硬件负载均衡和软件负载均衡，硬件负载均衡也称为硬负载，如 F5 负载均衡，相对造价昂贵成本较高，但是数据的稳定性安全性等等有非常好的保障，如中国移动中国联通这样的公司才会选择硬负载进行操作；更多的公司考虑到成本原因，会选择使用软件负载均衡，软件负载均衡是利用现有的技术结合主机硬件实现的一种消息队列分发机制。

#### Nginx 支持的负载均衡调度算法方式如下：

- weight 轮询(默认，常用)：接收到的请求按照权重分配到不同的后端服务器，即使在使用过程中，某一台后端服务器宕机，Nginx 会自动将该服务器剔除出队列，请求受理情况不会受到任何影响。 这种方式下，可以给不同的后端服务器设置一个权重值(weight)，用于调整不同的服务器上请求的分配率；权重数据越大，被分配到请求的几率越大；该权重值，主要是针对实际工作环境中不同的后端服务器硬件配置进行调整的。
- ip_hash（常用）：每个请求按照发起客户端的 ip 的 hash 结果进行匹配，这样的算法下一个固定 ip 地址的客户端总会访问到同一个后端服务器，这也在一定程度上解决了集群部署环境下 session 共享的问题。
- fair：智能调整调度算法，动态的根据后端服务器的请求处理到响应的时间进行均衡分配，响应时间短处理效率高的服务器分配到请求的概率高，响应时间长处理效率低的服务器分配到的请求少；结合了前两者的优点的一种调度算法。但是需要注意的是 Nginx 默认不支持 fair 算法，如果要使用这种调度算法，请安装 upstream_fair 模块。
- url_hash：按照访问的 url 的 hash 结果分配请求，每个请求的 url 会指向后端固定的某个服务器，可以在 Nginx 作为静态服务器的情况下提高缓存效率。同样要注意 Nginx 默认不支持这种调度算法，要使用的话需要安装 Nginx 的 hash 软件包。

### 分布式部署

- 也就是通过部署多台服务器来解决访问人数限制的问题；某~宝网站中大部分功能也是直接使用 nginx 进行反向代理实现的，并且通过封装 Nginx 和其他组件之后起了个高大上的名字：Tengine
