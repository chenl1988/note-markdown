## 作用域

- 作用域是指程序 源代码中定义变量的区域。

- 作用域规定了如何查找变量，也就是确定当前执行代码对变量的访问权限

- JavaScript 采用词法作用域（lexical scoping）,也就是**静态作用域**

- **函数的作用域基于函数创建的位置，函数的作用域是在函数定义的时候就决定了**

- javascript中执行一个函数会触发一次编译，编译完成之后立即执行

- javascript中只有函数作用域，没有块级作用域（ES6支持块级作用域）

- 作用域是在javascript的解释器在编译的阶段创建的，作用是对当前的函数和变量进行保存，而且限定了函数和变量的使用范围

- 作用域链是在编译完成之后在函数运行的过程当中创建的，他的作用：

  - 将创建的作用域连接起来
  
  - 当函数或变量进行访问的时候，要按着作用域链进行依次的访问


### 编译

- 程序中的一段源代码在执行之前会经历三个步骤，统称为“编译”。

  - 分词/词法分析（Tokenizing/Lexing）,这个过程会将由字符组成的字符串分解成（对编译语言来说）有意义的代码块。这些代码块被称为**词法单元（token）**; 例如 var a = 2;会被分解成：var、a、=、2
  - 解析/语法分析（Parsing）,这个过程是将记法单元流（数组）转换成一个由元素逐级嵌套所组成的代表了程序语法结构的树。这个树被称为“抽象语法树”（Abstract Syntax Tree, AST）

  - 代码生成，将 AST 转换为可执行代码的过程被称为代码生成。

### 查找变量

- 作用域是一套规则，用于确定在何处以及如何查找变量。如果查找的目的是对变量进行赋值，那么就会使用 LHS 查询；如果目的是获取变量的值，就会使用 RHS 查询

- 赋值操作符（=）或调用函数时传入参数的操作都会导致关联作用域的赋值操作

- javascript 引擎首先会在代码执行前对其进行编译，在这个过程，像 var a= 2;这样的声明会被分解成两个独立的步骤：

  - 首先，var a 在其作用域中声明新变量，这会在最开始的阶段，也就是代码执行前
  - 接下来，a=2 会查询（LHS 查询）变量 a 并对其进行赋值

- LHS 和 RHS 查询都会在当前执行作用域中开始，如果有需要，就会向上级作用域继续查找目标标识符，这样每次上升一级作用域，最后抵达全局作用域，无论找到还是没有找到都将停止

- 不成功的 RHS 查询会导致抛出 ReferenceError 异常，不成功的 LHS 查询会导致自动隐式地创建一个全局变量（非严格模式下）


